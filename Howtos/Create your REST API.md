# Create your REST API

This detailled section will cover how to make a REST API from scratch and use it in your project.

If you're not familiar with REST concepts, see [this great explanation](https://www.infoq.com/articles/rest-introduction/)

...

Let's get started!



## Prerequisites

First, you'll need a working setup of equal-framework on your localhost. See **Getting started > Quick start** (you can skip *3. Defining classes*)

If you look at the **Directory structure**, you'll get a good idea of what comes with every project. In this one, we'll use **actions**, **classes**, and **data**.

Each of those folders correspond to a specific role :

> /actions	=	method DO (post, put/patch, delete, ...)
>
> /data		= 	method GET (fetching data from server)
>
> /classes	=	class definition & DB architecture

Go ahead and create them in your package directory (ex: */public/packages/todolist/*)



## Defining classes

Open **/classes** (what a surprise!), and create a new file for each class you want to use.

To continue with our previous todolist-app example, we'll create two classes: Task and User.

##### Task.class.php

```php
<?php
namespace todolist; 	// declaring the package
use qinoa\orm\Model;	// calling the built-in Object handler

class Task extends Model {

    public static function getColumns() {
        return [
            'title'      => ['type' => 'string'],
            'content'    => ['type' => 'string'],
            'deadline'   => ['type' => 'datetime'],
            'user_id'    => ['type' => 'many2one',
                             'foreign_object' => 'todolist\User']
        ];
    }

}
```

##### User.class.php

```php
<?php
namespace todolist; 	// declaring the package
use qinoa\orm\Model;	// calling the built-in Object handler

class User extends Model {

    public static function getColumns() {
        return [
            'name'       => ['type' => 'string'],
            'tasks_ids'  => ['type' => 'one2many',
                             'foreign_object' => 'todolist\Task',
                             'foreign_field' => 'user_id']
        ];
    }

}
```

We're done! A few things to consider :

- In order to work your parameters have to match with your front-end

- Objects' IDs aren't needed here, they're automatically generated by eQual

- As you can see we're using a *[DBMS relationship](https://afteracademy.com/blog/what-are-the-different-types-of-relationships-in-dbms)*, linking **user_id** with **tasks_ids**.

  This is also handled by the framework, all you have to know is the definition syntax (see **Basics > Objects parameters**)



## Defining GET

Open **/data** and create a new file for each GET method you want to use.

In the following example, we're asking our database to retrieve all *tasks* :

##### tasks.php

```php
<?php 
use todolist\Task;	// calling our newly defined Task class

list($params, $providers) = announce([
    'description'   => 'Retrieve the list of existing tasks',
    'params'        => [
        'limit'     => [
            'type'      => 'integer',
            'min'       => 1,
            'max'       => 50,
            'default'   => 5
        ],
        'offset'     => [
            'type'      => 'integer',
            'min'       => 0,
            'default'   => 0
        ],
    ],
    'response' => [
        'content-type'  => 'application/json',
        'charset'       => 'utf-8',
        'accept-origin' => ['*']
    ],
    'providers' => ['context']
]);

list($context) = [ $providers['context'] ];

$list = Task::search([])
    	->read(['id', 'title', 'content', 'deadline', 'user_id' => ['id', 'name']])
    	->adapt('txt')
    	->get(true);

$context->httpResponse()
    	->body($list)
    	->send();
```

#### Code breakdown

**list()** does a lot of work :

- **announce()** to define values for our upcoming Http query
  - **description** explains what the query does
  - **params** can define the pagination method aswell as additional requirements for our Http query
    - **limit** tells how much items we expect, preventing data overload
    - **offset** allows to expand the **limit**
    - We can also use **id**, it's a common parameter to manipulate an item's ID
  - **response** defines the format of the server's response
  - **providers** helps us to access some useful services such as **context**, **orm**, **auth**
- ``` list($context) = [ $providers['context'] ]; ``` to implement the services we want to use



**$list** is where we receive the data from our query :

- **Task::search([])**  searchs for the array containing Task item(s)
- **->read([])** tells which object's parameters we want to retrieve
- **->adapt('txt')** turns the data to strings so it's easily readable
- **->get(true)** self-explanatory



Finally, **$context** is used to accomplish REST's purpose, displaying the data on our browser as JSON

```php
$context->httpResponse()->body($list)->send();
```



### Using GET in your browser

We'll assume we already have an existing database containing a data sample of tasks, and have already done the following :

```bash
php run.php --do=public:qinoa_test_package-consistency --package=todolist
php run.php --do=public:qinoa_init_package --package=todolist
```

Open your browser, and in the localhost page you defined for eQual

To the address bar, add this :

> ?get=todolist_tasks

**tasks** refers to our tasks.php located in */data*

It will display a JSON formatted answer showing an array of tasks

As easy as that. You now have a REST response that you can use in any frontend project



## Defining DO

